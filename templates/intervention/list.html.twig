{% extends 'base.html.twig' %}

{% block title %}
    Interventions
{% endblock %}

{% block breadcrumb %}
    <span class="mx-1">></span>
    Interventions
{% endblock %}

{% block body %}

<section class="w-full mr-auto">
	<div class="flex flex-col sm:flex-row sm:items-center items-start justify-between">
		<h1 class="font-medium text-[#1F384C] text-[26px] mb-[10px]">
			Interventions
		</h1>
		<a href="{{ path('intervention_new') }}">
			{% include 'composants/button.html.twig' with { label: 'Ajouter une nouvelle intervention', type: 'confirm' } %}
		</a>
	</div>
	<div class="mt-[40px]">
		<p class="text-[#FFBD01] font-medium text-[20px] pb-[10px]">
			Filtres
		</p>

        {{ form_start(form, {'attr': {'class': 'flex flex-col lg:flex-row lg:items-end gap-3'}}) }}

        <div class="flex flex-col w-full md:w-auto md:mr-4">
            {% include "composants/form_champ_date.html.twig" with {
                'label': 'Date de début',
                'field': form.start_date
            } %}
        </div>

        <div class="flex flex-col w-full md:w-auto md:mr-4">
            {% include "composants/form_champ_text.html.twig" with {
                'label': 'Date de fin',
                'field': form.end_date
            } %}
        </div>

        <div class="flex flex-col w-full md:w-auto md:mr-4">
            {% include "composants/form_champ_text.html.twig" with {
                'label': 'Module',
                'field': form.module_id
            } %}
        </div>

        <div class="mt-2 md:mt-0">
            {% include 'composants/button.html.twig' with {
                    label: 'Filtrer',
                    type: 'warning',
                } %}
        </div>

        {{ form_end(form) }}
    </div>

    <h1 class="font-medium text-[20px] text-[#1F384C] mt-6 mb-2">
        {{ interventions|length }}
        intervention{{ interventions|length > 1 ? 's' : ''}}
        trouvée{{ interventions|length > 1 ? 's' : ''}}
    </h1>

    {# Définition des 6 colonnes conformément au CDC #}
    {% embed 'composants/table.html.twig' with {
            headers: ['Date de l\'intervention', 'Module & titre', 'Type' , 'Intervenants', 'En visio', '']
        } %}
        {% block body %}
            {% for intervention in interventions %}
                <tr>
                    {# 1. Date de l'intervention #}
                    <td class="px-[25px] py-[20px] text-[#1F384C] text-[14px] font-medium">
                        {{ intervention.startDate|date('d/m/Y H\\hi') }} à {{ intervention.endDate|date('H\\hi') }}
                    </td>

                    {# 2. Module & Titre #}
                    <td class="px-[25px] py-[20px] text-[#1F384C] text-[14px] font-medium">
                        {{ intervention.ModuleId.name }}
                        {{ intervention.title is not empty ? ' - ' ~ intervention.title : '' }}
                    </td>

                    {# 3. Type d'intervention #}
                    <td class="px-[25px] py-[20px] text-[#1F384C] text-[14px] font-medium">
                        {{ intervention.interventionTypeId.name }}
                    </td>

                    {# 4. Intervenants (Liste propre) #}
                    <td class="px-[25px] py-[20px] text-[#1F384C] text-[14px] font-medium">
                        {% for ci in intervention.courseInstructors %}
                            {{ ci.instructor.user.firstName|slice(0, 1)|upper }}. {{ ci.instructor.user.lastName|upper }}
                            {% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </td>

                    {# 5. En Visio (Colonne séparée) [cite: 146] #}
                    <td class="px-[25px] py-[20px]">
                        {% if intervention.remotely %}
                            <img class="w-[16px] h-[16px]" src="{{ asset('img/cam_on.png') }}" alt="En visio" title="En visio">
                        {% else %}
                            <img class="w-[16px] h-[16px]" src="{{ asset('img/cam_off.png') }}" alt="Présentiel" title="Présentiel">
                        {% endif %}
                    </td>

                    {# 6. Actions (Oeil + Lien) (Colonne séparée) [cite: 148] #}
                    <td class="px-[25px] py-[20px]">
                        <div class="flex items-center gap-2">
                            <img class="w-[16px] h-[16px]" src="{{ asset('img/oeil (1).png') }}" alt="Voir">
                            <a href="{{ path('intervention_edit', { id: intervention.id }) }}" class="text-[#1F384C] text-[14px] font-medium hover:underline">
                                Accéder à la fiche
                            </a>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        {% endblock %}
    {% endembed %}
</section>

{% endblock %}