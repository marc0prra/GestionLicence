{% extends 'base.html.twig' %}

{% block body %}
	<section class="max-w-[800px] mx-auto bg-white p-8 rounded-[20px] shadow-sm mt-10">
		<h1 class="text-[24px] font-bold mb-6">
			{{ course.id is true ? 'Modifier l\'intervention' : 'Nouvelle intervention' }}
    </h1>

    {{ form_start(form, {'attr': {'id': 'course_form'}}) }}
        
        <div class="space-y-6">
            {% include "composants/form_champ_text.html.twig" with { 'label' : 'Titre', 'field' : form.title, } %}

            <div class="grid grid-cols-2 gap-4">
                <div>
                    {% include "composants/form_champ_date.html.twig" with { 'label': 'Début', 'field': form.start_date, } %}
                </div>
                <div>
                    {% include "composants/form_champ_date.html.twig" with { 'label': 'Fin', 'field': form.end_date, } %}
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                {% include "composants/form_champ_select.html.twig" with { 'label' : 'Module', 'field' : form.module_id } %}
                {% include "composants/form_champ_select.html.twig" with { 'label' : "Type d'intervention", 'field' : form.intervention_type_id } %}
            </div>

            {% include "composants/multi_select.html.twig" with { 'label': 'Intervenants', 'field' : form.courseInstructors } %}
            {% include "composants/form_champ_switch.html.twig" with { 'label' : 'Intervention effectuée en visio', 'field' : form.remotely } %}
        </div>

        {# Actions #}
        <div class="flex gap-4 pt-6 w-full">
            <div class="flex-1">
                {% include "composants/button.html.twig" with { 
                    'label': 'Retour', 
                    'type': 'cancel', 
                    'url': path('interventions'),
                    'fullWidth': true 
                } %}
            </div>

            {# Bouton SUPPRIMER #}
                {% if is_edit %}
                    <div class="flex-1">
                        {% include 'composants/button.html.twig' with {
                            'label': 'Supprimer',
                            'type': 'delete',
                            'buttonType': 'button',
                            'fullWidth': true,
                            'onclick': "toggleDeletePeriodModal()"
                        } %}
                    </div>
                {% endif %}

            <div class="flex-1">
                {% include "composants/button.html.twig" with { 
                    'label': 'Enregistrer', 
                    'type': 'confirm', 
                    'buttonType': 'submit',
                    'fullWidth': true
                } %}
            </div>
        </div>

    {{ form_end(form) }}
</section>

    {# MODULE DE SUPPRESSION #}
{% if is_edit %}
    {# On appelle le composant sans se soucier des variables d'ID, #}
    {# car le fichier pop_up.html.twig utilise déjà id="modal-delete" #}
    {% include 'composants/pop_up.html.twig' with {
        'title': 'Supprimer l\'intervention',
        'message': 'Vous vous apprêtez à supprimer cette intervention, cette action est irrévocable.',
        'question': 'Confirmez-vous la suppression ?'
    } %}
    
    {# Formulaire de suppression caché #}
    <form id="delete-period-form" 
          method="post" 
          action="{{ path('interventions_delete', {'id': course.id}) }}" 
									          class="hidden">
			<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ course.id) }}">
		</form>

		<script>
			/**
         * 1. Ouvre la modal
         * Appelée par ton bouton "Supprimer" du formulaire (onclick="toggleDeletePeriodModal()")
         */
function toggleDeletePeriodModal() {
const modal = document.getElementById('modal-delete');
if (modal) 
modal.classList.remove('hidden');



}

/**
         * 2. Ferme la modal
         * Appelée par le bouton "Annuler" DU COMPOSANT (onclick="toggleModal()")
         */
function toggleModal() {
const modal = document.getElementById('modal-delete');
if (modal) 
modal.classList.add('hidden');



}

/**
         * 3. Valide la suppression
         * Appelée par le bouton "Confirmer" DU COMPOSANT (onclick="confirmDelete()")
         */
function confirmDelete() {
const form = document.getElementById('delete-period-form');
if (form) 
form.submit();



}
		</script>
	{% endif %}
{% endblock %}
