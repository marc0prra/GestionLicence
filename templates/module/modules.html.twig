{% extends 'base.html.twig' %}

{% block title %}
    Modules
{% endblock %}

{% block body %}
<div class="container mt-4 mb-4">
    <h1 class="font-medium text-[#1F384C] text-[26px] mb-[10px]">
        Modules
	</h1>

    {% for block in blocks %}
        <div class="border-2 border-dashed border-gray-400/20 rounded-2xl p-4 mb-8 w-300 gap-6">
            
            <h3 class="text-[#FFBD01] font-medium text-[20px] pb-[10px]"">
                {{ block.code }} : {{ block.description  }} 
                <span class="text-[#FFBD01] text-lg font-medium">({{ block.hoursCount|default(0) }}h)</span>
            </h3>

            <div class="mt-3 pl-3">
                {% for module in block.modules %}
                    {% if module.parent is null %}
                        {{ _self.display_tree(module) }}
                    {% endif %}

                {% else %}
                    <p class="text-muted">Aucun module.</p>
                {% endfor %}
            </div>
        </div>
        <div class="mt-3 my-10">
            <a href="{{ path('app_module_new', {'block_id': block.id}) }}" class="text-white bg-[#1e293b] hover:bg-slate-800 
            focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
        Ajouter un module
    </a>
        </div>
    {% endfor %}
</div>

{# --- MACRO --- #}
    {% macro display_tree(module) %}
        {% import _self as macros %}

        <div class="mb-1">
            <a href="{{ path('app_module_edit', {id: module.id}) }}" 
               class="flex items-center w-full text-slate-700 hover:text-indigo-600 hover:bg-gray-50 px-2 py-1.5 rounded transition-colors cursor-pointer select-none">
                
                {# Nom du module #}
                <span class="font-medium text-sm">{{ module.name }}</span>
                
                {# Heures #}
                <span class="text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full 
                group-hover:bg-indigo-100 
                group-hover:text-indigo-700">
                    {{ module.hoursCount }}h
                </span>

                <span class="ml-auto group-hover:text-indigo-500">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                    </svg>
                </span>
            </a>

            {# Enfants#}
            {% if module.children is not empty %}
                {# Ligne verticale en pointillés pour la hiérarchie #}
                <div class="ml-4 border-l border-dashed border-gray-300 pl-2 mt-1">
                    {% for child in module.children %}
                        {{ macros.display_tree(child) }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    {% endmacro %}
{% endblock %}
