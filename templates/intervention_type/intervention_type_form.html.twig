{% extends 'intervention/list.html.twig' %}

{% block title %}
	{{ interventionType.id ? 'Modifier' : 'Créer' }}
	un type d'intervention
{% endblock %}

{% block breadcrumb %}
	{{ parent() }}
	<span class="mx-1">></span>
	{{ interventionType.name }}
{% endblock %}

{% block body %}
<div
	class="p-6 bg-white rounded-lg">
	{# --- TITRE --- #}
	<h1 class="font-medium text-[#1F384C] text-[26px] mb-[10px]">
		{{ interventionType.name|default('Nouveau type d\'intervention') }}
	</h1>

	{{ form_start(form) }}

	{# --- CHAMPS NOM ET COULEUR SUR LA MÊME LIGNE --- #}
	<div class="flex flex-col md:flex-row gap-6 mb-6 max-w-[1200px]">
		{# Nom #}
		<div class="flex-1">
			<label class="block mb-2 text-sm font-medium text-[#1F384C]">
				Nom - <span class="text-gray-500">champ obligatoire</span>
			</label>
			{{ form_widget(form.name, {
				'attr': {
					'class': 'bg-[#F9FAFB] border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-3',
					'placeholder': 'Ex: Cours'
				}
			}) }}
			{{ form_errors(form.name) }}
		</div>

		{# Code couleur #}
		<div class="flex-1">
			<label class="block mb-2 text-sm font-medium text-[#1F384C]">
				Couleur - <span class="text-gray-500">champ obligatoire</span>
			</label>
			<div class="flex items-center gap-3">
				{{ form_widget(form.color, {
					'attr': {
						'class': 'w-[80px] h-[45px] bg-[#F9FAFB] px-2 py-1 border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500',
						'onchange': 'updateColorDisplay(this.value)'
					}
				}) }}
				<span id="color-display" class="text-sm font-mono text-gray-700 bg-gray-100 px-3 py-2 rounded border border-gray-300">
					{{ form.color.vars.value|default('#6750A4') }}
				</span>
			</div>
			{{ form_errors(form.color) }}
		</div>
	</div>

	{# --- DESCRIPTION --- #}
	<div class="mb-8 max-w-[1200px]">
		<label class="block mb-2 text-sm font-medium text-[#1F384C]">
			Description - <span class="text-gray-500">champ obligatoire</span>
		</label>
		{{ form_widget(form.description, {
			'attr': {
				'class': 'block p-3 w-full text-sm text-gray-900 bg-[#F9FAFB] rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500',
				'rows': '4',
				'placeholder': 'Description du type d\'intervention...'
			}
		}) }}
		{{ form_errors(form.description) }}
	</div>

	{# --- BOUTONS D'ACTION --- #}
	<div
		class="flex flex-wrap items-center gap-4 pt-6 max-w-[1200px]">
		{# BOUTON RETOUR #}
		<a href="{{ path('intervention_type') }}" class="inline-flex items-center justify-center bg-[#F0F0F0] hover:bg-gray-200 text-[#1F384C] font-medium py-3 px-8 rounded-lg transition-colors border border-gray-300">
			Retour à la liste
		</a>

		{% if interventionType.id %}
			{# BOUTON SUPPRIMER #}
			<button type="button" onclick="toggleModal()" class="inline-flex items-center justify-center text-white bg-[#FF0004] hover:bg-red-700 font-medium py-3 px-8 rounded-lg transition-colors">
				Supprimer
			</button>
		{% endif %}

		{# BOUTON ENREGISTRER #}
		<button type="submit" class="inline-flex items-center justify-center text-white bg-[#2C416E] hover:bg-[#1F384C] font-medium py-3 px-8 rounded-lg transition-colors">
			Enregistrer les informations
		</button>
	</div>

	{{ form_end(form) }}

	{% if interventionType.id %}

		{% include 'composants/pop_up.html.twig' with {
            'title': 'Supprimer le type d\'intervention',
            'message': "Vous vous apprêtez à supprimer ce type d'intervention. Cette action est irrévocable.",
        } %}

        <form id="delete-form-{{ interventionType.id }}" 
              action="{{ path('intervention_type_delete', {'id': interventionType.id}) }}" 
              method="post" 
              class="hidden">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ interventionType.id) }}">
        </form>
    {% endif %}

    <script>
    function updateColorDisplay(color) {
        const displayElement = document.getElementById('color-display');
        if (displayElement) {
            displayElement.textContent = color.toUpperCase();
        }
    }

    function toggleModal() {
        const modal = document.getElementById('modal-delete');
        if (modal) {
            modal.classList.toggle('hidden');
        }
    }

    function confirmDelete() {
        const deleteForm = document.getElementById('delete-form-{{ interventionType.id }}');
        if (deleteForm) {
            deleteForm.submit();
        }
    }
    </script>

</div>
{% endblock %}
