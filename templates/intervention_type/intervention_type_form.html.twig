{% extends 'base.html.twig' %}

{% block title %}
	{{ interventionType.id ? 'Modifier' : 'Créer' }}
	un type d'intervention
{% endblock %}

{% block body %}
<div
	class="p-4 bg-white rounded-lg">

	{# --- TITRE --- #}
	<h1 class="font-medium text-[#1F384C] text-[26px] mb-[10px]">
		{{ interventionType.id ? 'Modifier' : 'Créer' }}
		un type d'intervention
	</h1>

	{{ form_start(form) }}

	{# --- 1. CHAMPS DU FORMULAIRE --- #}

	{# Nom #}
		<div class="mb-6"> {{ form_label(form.name, 'Nom', {'label_attr': {'class': 'block mb-2 text-sm font-medium text-gray-900'}}) }}
		{{ form_widget(form.name, {
            'attr': {
                'class': 'bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5',
                'placeholder': 'Ex: Cours Magistral'
            }
        }) }}
		{{ form_errors(form.name) }}
	</div>

	{# Couleur #}
	<div class="mb-6">
		{{ form_label(form.color, 'Code couleur', {'label_attr': {'class': 'block mb-2 text-sm font-medium text-gray-900'}}) }}
		<div class="relative">
			{{ form_widget(form.color, {
                'attr': {
                    'class': 'bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5',
                    'placeholder': 'Ex: #6750A4'
                }
            }) }}
		</div>
		<p class="mt-2 text-sm text-gray-500">
			{{ form_help(form.color) }}
		</p>
		{{ form_errors(form.color) }}
	</div>

	{# Description #}
	<div class="mb-8">
		{{ form_label(form.description, 'Description', {'label_attr': {'class': 'block mb-2 text-sm font-medium text-gray-900'}}) }}
		{{ form_widget(form.description, {
            'attr': {
                'class': 'block p-2.5 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500',
                'rows': '4',
                'placeholder': 'Description du type d\'intervention...'
            }
        }) }}
        {{ form_errors(form.description) }}
    </div>

    <div class="flex items-center justify-between pt-4 border-t border-gray-100">
        
        <a href="{{ path('intervention_type') }}" 
           class="inline-block bg-gray-100 hover:bg-gray-200 text-black font-medium py-3 px-8 rounded-xl transition-colors">
            Retour à la liste
        </a>

        <div class="flex gap-3">
            {% if interventionType.id %}
                <button type="button" 
                        onclick="toggleModal()" 
                        class="text-white bg-[#ff0000] hover:bg-red-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    Supprimer
                </button>
            {% endif %}

            <button type="submit" class="text-white bg-[#1e293b] hover:bg-slate-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Enregistrer les informations
            </button>
        </div>
    </div>

    {{ form_end(form) }}

		{% if interventionType.id %}

			{% include 'composants/pop_up.html.twig' with {
            'title': 'Supprimer le type d\'intervention',
            'message': "Vous vous apprêtez à supprimer ce type d'intervention. Cette action est irrévocable.",
        } %}

        <form id="delete-form-{{ interventionType.id }}" 
              action="{{ path('intervention_type_delete', {'id': interventionType.id}) }}" 
              method="post" 
              class="hidden">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ interventionType.id) }}">
        </form>
    {% endif %}

    <script>
    function toggleModal() {
        const modal = document.getElementById('modal-delete');
        if (modal) {
            modal.classList.toggle('hidden');
        }
    }

    function confirmDelete() {
        const deleteForm = document.getElementById('delete-form-{{ interventionType.id }}');
        if (deleteForm) {
            deleteForm.submit();
        }
    }
    </script>

</div>
{% endblock %}
